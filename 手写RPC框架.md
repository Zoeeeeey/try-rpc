# 手写RPC框架

## 学习计划

- 初学（视频教程、项目笔记）->实践（编写代码、项目上线）->扩展（项目功能丰富）->求职（简历、面经）

## 基本概念

- RPC（Remote Procedure Call，远程过程调用）

  - 一种计算机通信协议
  - 允许程序在不同计算机之间进行交互，就像本地调用一样

- 为什么需要RPC

  - 没有RPC时，项目B如何调用项目A的服务？

    - （项目A、B独立，因此不能像SDK一样作为依赖包引入）->maybe 雷点
    - 需要项目A提供web服务，并且编写一个点餐接口暴露服务
      - 比如访问`http://zzy.order`来调用点餐服务
    - 而项目B作为服务消费者，需要自己构造请求，并通过HttpClient请求上述的地址

  - 因此：如果项目B要调用更多第三方服务，每个服务和方法的调用都得编写一个HTTP请求，将非常麻烦

    ```python
    url = "http://zzy.order"
    req = new Req(参数1, 参数2, 参数3)
    res = httpClient.post(url).body(req).execute()
    orderId = res.data.orderId
    ```

    

  - RPC能做什么？

    - RPC允许一个程序（服务消费者）
      - 像调用自己程序的方法一样，调用另一个程序（服务提供者）的接口
      - 而不需要了解数据的传输处理过程、底层网络通信的细节
    - RPC框架帮助开发者
      - 轻松调用远程服务，快速开发分布式系统

  - 因此，有了RPC框架，项目B可以通过一行代码完成调用

    ```
    orderId = orderService.order(参数1, 参数2, 参数3)
    ```

## v0.1

RPC框架实现思路

<img src=".\img\1_rpc_framework.png" style="zoom:100%;" />

- 请求客户端（HTTP/其他）+Web服务器

  - 消费者想要调用提供者，就需要启动一个web服务
  - 然后通过`请求客户端`发送HTTP或者其他协议的请求来调用

- 本地服务注册器

  - 因为服务者可能提供了多个服务和方法，不可能让消费者针对每个接口都写一段HTTP的调用逻辑

    - 可以提供一个统一的服务调用接口，通过`请求处理器`根据客户端的请求参数来进行不同的处理、调用不同的服务和方法

  - 因此，服务器提供者的程序可以维护一个`本地服务注册器`，记录服务和对应实现类的映射

    ```
    例如：消费者要调用orderService服务的order方法
    请求参数：service=orderService, method=order
    请求处理器会根据service从服务注册器中找到对应的服务实现类，并通过Java的反射机制调用method指定的方法
    ```

- 序列化/反序列化

  - 由于Java对象无法直接在网络中传输，所以要对传输的参数进行序列化和反序列化

- 代理对象

  - 为了简化消费者发送请求的代码，实现类似本地调用的体验
  - 可以基于代理模式，为消费者要调用的几口生成一个代理对象，由代理对象完成请求和响应的过程

## 扩展设计

- 服务注册发现
- 负载均衡
- 容错机制
- 其他
